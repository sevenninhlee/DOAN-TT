{"remainingRequest":"/var/www/html/Jobs/DOAN-TT/client/node_modules/vue-loader/lib/index.js??vue-loader-options!/var/www/html/Jobs/DOAN-TT/client/src/views/document/Prepare.vue?vue&type=script&lang=js&","dependencies":[{"path":"/var/www/html/Jobs/DOAN-TT/client/src/views/document/Prepare.vue","mtime":1573548269934},{"path":"/var/www/html/Jobs/DOAN-TT/client/node_modules/cache-loader/dist/cjs.js","mtime":1571633391755},{"path":"/var/www/html/Jobs/DOAN-TT/client/node_modules/babel-loader/lib/index.js","mtime":1571304325577},{"path":"/var/www/html/Jobs/DOAN-TT/client/node_modules/cache-loader/dist/cjs.js","mtime":1571633391755},{"path":"/var/www/html/Jobs/DOAN-TT/client/node_modules/vue-loader/lib/index.js","mtime":1571304326381}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport \"bootstrap/dist/js/bootstrap.min.js\";\nimport \"bootstrap-multiselect/dist/css/bootstrap-multiselect.css\";\n\nimport { mapGetters } from \"vuex\";\nimport UserIcon from \"../../components/UserIcon\";\nimport UserSelect from \"../../components/UserSelect\";\nimport {\n  GET_DOCUMENT_REQUEST,\n  GET_BLOD_FROM_URL,\n  ADD_ANNTATION,\n  GET_ANNTATION,\n  EDIT_ANNTATION,\n  DELETE_ANNTATION,\n  ADD_ROTATE_DOCUMENTS,\n  ADD_DELETE_DOCUMENTS\n} from \"../../store/modules/document\";\nimport store from \"../../store/store\";\nimport { GET_DOCS } from \"../../store/actions.type\";\nimport pdf from \"vue-pdf\";\nimport draggable from \"vuedraggable\";\nimport { addParamsToBlob } from \"../../helpers\";\nimport {\n  prepareHandle,\n  generalDefaultButton,\n  initialPrepare,\n  history,\n  unredoButton,\n  userSideBarHandle,\n  addCommentToDocument,\n  rotateFunction,\n  deleteSuccessHandle\n} from \"../../helpers/prepareHandle\";\nimport config from \"../../config/config\";\nimport { EventBus } from \"../../config/event-bus\";\n\nexport default {\n  name: \"Prepare\",\n  components: {\n    pdf,\n    UserIcon,\n    UserSelect,\n    draggable\n  },\n  computed: {\n    ...mapGetters([\"addDocument\", [GET_DOCUMENT_REQUEST], \"getRecipients\"])\n  },\n  data() {\n    return {\n      documentList: [],\n      pages: [],\n      sign_items: [],\n      percent: \"100%\",\n      viewSrc: null,\n      viewPage: 0,\n      currentPage: 0,\n      pageCount: 0,\n      src: null,\n      numPages: undefined,\n      annotations: [],\n      pageLoading: true,\n      nextLoading: false,\n      commentButtonActive: false,\n      recipientsList: []\n    };\n  },\n  mounted() {\n    let vm = this;\n    let backendUrl = `${config.BASE_URL}`;\n    let document_id = vm.$route.query.document_id;\n    vm.pages = [];\n    vm.documentList = [];\n\n    store\n      .dispatch(GET_DOCS, document_id)\n      .then(res => {\n        vm.recipientsList = vm.getRecipients;\n      })\n      .catch(err => {});\n\n    store.dispatch(GET_ANNTATION, document_id).then(res => {\n      if (res.status && res.annotations && res.annotations.length > 0) {\n        vm.annotations = res.annotations;\n        EventBus.$on(\"recipientsList\", recipients => {\n          this.recipientsList = recipients;\n          recipients &&\n            generalDefaultButton(vm.annotations, recipients, this.prepareEvent);\n        });\n      }\n    });\n\n    this.initialFunction();\n  },\n  methods: {\n    initialFunction() {\n      let vm = this;\n      let backendUrl = `${config.BASE_URL}`;\n      let document_id = vm.$route.query.document_id;\n      vm.pages = [];\n      vm.documentList = [];\n\n      store\n        .dispatch(GET_DOCUMENT_REQUEST, { document_id, show_image: 1 })\n        .then(res => {\n          vm.documentList = vm[GET_DOCUMENT_REQUEST];\n          if (\n            vm.documentList &&\n            vm.documentList.data &&\n            vm.documentList.data.length > 0\n          ) {\n            vm.documentList.data.map((v, docKey) => {\n              v.images = v.images &&\n                v.images.length > 0 &&\n                v.images.filter((img, imgKey) => {\n                  let checkPageDelete =\n                    v.document_action.length > 0 &&\n                    v.document_action.find(\n                      ac => ac.page === imgKey + 1 && ac.delete === 1\n                    );\n                  !checkPageDelete && vm.pages.push({\n                    docId: v.id,\n                    pageId: docKey,\n                    pageNum: this.numpage(img),\n                    image: img\n                  });   \n                  return !checkPageDelete;\n                  \n                });\n            });\n            vm.pageLoading = false;\n            initialPrepare(vm.pages);\n            // general drop\n            prepareHandle(\n              vm.pages.map((v, key) => key),\n              this.recipientsList,\n              this.prepareEvent\n            );\n          }\n        // console.log('vm.documentList.data', vm.documentList.data[0])\n        // console.log('vm.pages', vm.pages)\n\n        });\n      vm.$root.$on(\"bv::scrollspy::activate\", vm.onActivate);\n    },\n    deleteHandle(docId, imgUrl) {\n      let numPage = this.numpage(imgUrl);\n      if(numPage) {\n        this.pageLoading = false;\n        let sendData = {\n          document_id: docId,\n          page: numPage,\n          delete: 1\n        };\n        this.$store.dispatch(ADD_DELETE_DOCUMENTS, sendData).then(res => {\n          if (res.status) {\n            this.pageLoading = true;\n            deleteSuccessHandle(docId, numPage);\n            this.initialFunction();\n          }\n        });\n      }\n    },\n    numpage(imgUrl) {\n      let arrayImgUrl = imgUrl.split(\"/\").pop();\n      return parseInt(arrayImgUrl.split(\".\")[0].slice(-1));\n    },\n    checkHasDeletePage(document_action, pageId) {\n      let _result =\n        document_action.length > 0 &&\n        document_action.find(v => v.page === pageId && v.delete === 1);\n      return !!_result;\n    },\n    rotateHandle(location, docId, pageId) {\n      let vm = this;\n\n      rotateFunction(location, docId, pageId, sendData => {\n        vm.$store.dispatch(ADD_ROTATE_DOCUMENTS, sendData);\n      });\n    },\n    checkRotate(data, document) {\n      let getRotate =\n        document &&\n        document.document_action &&\n        document.document_action.length > 0 &&\n        document.document_action.find(v => v.page === data.pageNum + 1);\n      return getRotate && getRotate.rotate;\n    },\n    undo() {\n      let vm = this;\n      let document_id = vm.$route.query.document_id;\n      history.undo(vm.annotations);\n      if (history && history.restore_state && history.restore_state.id) {\n        const annotations_id = history.restore_state.id;\n        unredoButton(annotations_id, \"undo\");\n        vm.$store\n          .dispatch(EDIT_ANNTATION, { id: annotations_id, display: \"none\" })\n          .then(res => {\n            if (res.status && res.annotation_id) {\n              vm.$store.dispatch(GET_ANNTATION, document_id).then(res => {\n                if (\n                  res.status &&\n                  res.annotations &&\n                  res.annotations.length > 0\n                ) {\n                  vm.annotations = res.annotations;\n                }\n              });\n            }\n          });\n      }\n    },\n    redo() {\n      let vm = this;\n      let document_id = vm.$route.query.document_id;\n      history.redo();\n      if (history && history.restore_state && history.restore_state.id) {\n        const annotations_id = history.restore_state.id;\n        unredoButton(annotations_id, \"redo\");\n        vm.$store\n          .dispatch(EDIT_ANNTATION, { id: annotations_id, display: \"block\" })\n          .then(res => {\n            if (res.status && res.annotation_id) {\n              vm.$store.dispatch(GET_ANNTATION, document_id).then(res => {\n                if (\n                  res.status &&\n                  res.annotations &&\n                  res.annotations.length > 0\n                ) {\n                  vm.annotations = res.annotations;\n                }\n              });\n            }\n          });\n      }\n    },\n    commentsHandle() {\n      addCommentToDocument(\n        this.pages.map((v, key) => key),\n        this.recipientsList,\n        this.prepareEvent\n      );\n    },\n    changePercent(e) {\n      this.percent = e;\n      var zoomScale = Number(parseInt(e.replace(\"%\", \"\"))) / 100;\n      for (\n        var i = 0;\n        i < document.getElementsByClassName(\"droppable_content\").length;\n        i++\n      ) {\n        this.setZoom(\n          zoomScale,\n          document.getElementsByClassName(\"droppable_content\")[i]\n        );\n      }\n    },\n    setZoom(zoom, el) {\n      var transformOrigin = [0, 0];\n      el = el || instance.getContainer();\n      var p = [\"webkit\", \"moz\", \"ms\", \"o\"],\n        s = \"scale(\" + zoom + \")\",\n        oString =\n          transformOrigin[0] * 100 + \"% \" + transformOrigin[1] * 100 + \"%\";\n\n      for (var i = 0; i < p.length; i++) {\n        el.style[p[i] + \"Transform\"] = s;\n        el.style[p[i] + \"TransformOrigin\"] = oString;\n      }\n\n      el.style[\"transform\"] = s;\n      el.style[\"transformOrigin\"] = oString;\n      el.style[\"height\"] = \"auto\";\n      el.childNodes[0].style[\"height\"] = \"auto\";\n    },\n    onActivate(target) {\n      // console.log(\"target\", target);\n    },\n    selectPage(data, imgKey) {\n      let scrollId = `doc_id_${data.id}_${imgKey}`;\n      var scrollTo = document.getElementById(scrollId);\n      scrollTo.scrollIntoView();\n    },\n    moveNextPage() {\n      if (!this.checkUserTool()) {\n        this.$awn.alert(\"Add at least 1 tool\", {\n          position: \"bottom-left\",\n          labels: {\n            alert: \"Danger Message\"\n          }\n        });\n        return false;\n      }\n      this.nextLoading = true;\n      this.$router.push(\n        \"/docu-sign/review?document_id=\" + this.$route.query.document_id\n      );\n    },\n    checkUserTool() {\n      return $(`div[id^='droppable_content_'] .user-drag`).length > 0;\n    },\n    moveBackPage() {\n      this.$router.push(\n        \"/docu-sign/add-recipients?document_id=\" + this.$route.query.document_id\n      );\n    },\n    addRecipient() {\n      this.recipients.push({\n        sign_type: \"Need to sign\",\n        com_type: false,\n        name: \"\",\n        email: \"\",\n        set_password: false,\n        password: \"\",\n        confirm_password: \"\"\n      });\n    },\n    removeRecipient(index) {\n      this.recipients.splice(index, 1);\n    },\n    prepareEvent(data, element) {\n      const vm = this,\n        document_id = vm.$route.query.document_id;\n      let sendData = data.send_data;\n      sendData.annotation_id = document_id;\n      data.annotation_id && (sendData.id = data.annotation_id);\n\n      var checkElemnts = $(\".tool-sign:hidden\");\n      vm.$store.dispatch(ADD_ANNTATION, sendData).then(res => {\n        let get_annotation_id = element.data(\"annotation_id\");\n        if (res.status && res.annotation_id && !get_annotation_id) {\n          if (\n            !sendData.id &&\n            history.redo_list &&\n            history.redo_list.length > 0\n          ) {\n            history.redo_list.map((val, key) => {\n              let annotation_id = val.id;\n              vm.$store.dispatch(DELETE_ANNTATION, annotation_id).then(res => {\n                checkElemnts[key].remove();\n              });\n            });\n          }\n          element.attr(\"data-annotation_id\", res.annotation_id);\n          element.addClass(\"tool-sign tool_sign_\" + res.annotation_id);\n        }\n        if (sendData.text && sendData.recipient_arr) {\n          element.popover(\"hide\");\n          element.css(\"opacity\", 0.5);\n        }\n        vm.$store.dispatch(GET_ANNTATION, document_id).then(res2 => {\n          if (res2.status && res2.annotations && res2.annotations.length > 0) {\n            vm.annotations = res2.annotations;\n          }\n        });\n      });\n    }\n  },\n  created() {}\n};\n",{"version":3,"sources":["Prepare.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8JA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Prepare.vue","sourceRoot":"src/views/document","sourcesContent":["<template>\n  <div class=\"app flex-row\">\n    <div class=\"w-100\">\n      <div class=\"d-flex justify-content-between align-items-center\">\n        <h1>{{ $t(\"docsign.prepare.title\") }}</h1>\n        <div class=\"d-flex align-items-center control-actions\">\n          <b-button variant=\"outline-primary\" @click=\"undo\">\n            <!-- <UserIcon icon=\"past_changes.svg\" :button=\"true\"/> -->\n            <template>\n              <img src=\"img/icons/past_changes.svg\" class=\"icon-hover\" />\n            </template>\n          </b-button>\n          <b-button variant=\"outline-primary\" @click=\"redo\">\n            <!-- <UserIcon icon=\"next_changes.svg\" :button=\"true\" /> -->\n            <template>\n              <img src=\"img/icons/next_changes.svg\" class=\"icon-hover\" />\n            </template>\n          </b-button>\n          <UserSelect\n            v-bind:value=\"percent\"\n            v-bind:items=\"['10%','20%', '30%', '50%', '75%','100%', '200%']\"\n            @changeValue=\"changePercent\"\n            class=\"mb-0 mx-2\"\n          />\n          <b-button\n            variant=\"outline-primary\"\n            @click=\"commentsHandle\"\n            v-bind:class=\"commentButtonActive && 'commentButtonActive'\"\n          >\n            <UserIcon icon=\"comment.svg\" :button=\"true\" />\n          </b-button>\n        </div>\n      </div>\n      <hr class=\"mb-4\" />\n      <div class=\"row\">\n        <div class=\"col-md-9 pr-3 pr-sm-0\">\n          <div v-if=\"pageLoading\" class=\"pageLoading\">\n            <i class=\"fa fa-spinner fa-spin fa-3x\" />\n          </div>\n          <div v-if=\"!pageLoading\" id=\"document_container\">\n            <div class=\"wrap_docs\">\n              <div\n                v-for=\"(data, key) in pages\"\n                :key=\"key\"\n                :id=\"`droppable_content_${key + 1}`\"\n                :data-page_num=\"key + 1\"\n                :data-doc_id=\"data.docId\"\n                :data-rotate=\"checkRotate(data, documentList.data[data.pageId])\"\n                style=\"position:relative\"\n                class=\"droppable_content\"\n              >\n                <div :id=\"`doc_id_${data.docId}_${data.pageNum}`\" class=\"content-background\">\n                  <div class=\"loader_img\">\n                    <i class=\"fa fa-spinner fa-spin fa-2x\" />\n                  </div>\n                  <img\n                    :src=\"`${data.image}`\"\n                    class=\"w-100 main_img img_zoom\"\n                    v-bind:class=\"key==viewPage?'selected-pdf':''\"\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"col-md-3 pl-3\">\n          <div class=\"aaa\">\n            <div class=\"content-container\">\n              <div class=\"documents\">\n                <div class=\"title\">\n                  <span>{{ $t(\"docsign.documents\") }}</span>\n                  <!-- <div class=\"actions\">\n                    <i class=\"fa fa-rotate-left mr-2 clickable-icon\" @click=\"rotateHandle('left')\"></i>\n                    <i\n                      class=\"fa fa-rotate-right mr-2 clickable-icon\"\n                      @click=\"rotateHandle('right')\"\n                    ></i>\n                    <i class=\"fa fa-trash clickable-icon\" @click=\"deleteHandle\"></i>\n                  </div>-->\n                </div>\n                <hr />\n                <div class=\"documents-list\">\n                  <div class=\"document-content\" v-for=\"(file, key) in documentList.data\" :key=\"key\">\n                    <div v-if=\"file.images.length > 0\">\n                      <div\n                        class=\"collapse-header item-title\"\n                        v-b-toggle=\"`document_list_toggle_${key}`\"\n                      >\n                        <span class=\"title\">{{file.document_name}}</span>\n                        <span class=\"collapse-icon\">\n                          <i class=\"fa fa-caret-left\" />\n                        </span>\n                      </div>\n                    </div>\n                    <b-collapse :id=\"`document_list_toggle_${key}`\" class=\"item-pages\" visible v-if=\"file.images.length > 0\">\n                      <div\n                        class=\"page-content\"\n                        v-for=\"(image, imgKey) in file.images\"\n                        :key=\"imgKey\"\n                      >\n                        <div\n                          :id=\"`doc_nav_id_${file.id}_${imgKey}`\"\n                          class=\"pdf-content\"\n                          v-on:click=\"selectPage(file, numpage(image))\"\n                        >\n                          <div class=\"loader_img\" v-if=\"pageLoading\">\n                            <i class=\"fa fa-spinner fa-spin fa-2x\" />\n                          </div>\n                          <img :src=\"`${image}`\" class=\"w-100 selected-pdf main_img\" />\n                        </div>\n                        <div class=\"actionsButton\">\n                          <i\n                            class=\"fa fa-rotate-left mr-2 clickable-icon\"\n                            @click=\"rotateHandle('left', file.id, numpage(image))\"\n                          />\n                          <i\n                            class=\"fa fa-rotate-right mr-2 clickable-icon\"\n                            @click=\"rotateHandle('right', file.id, numpage(image))\"\n                          />\n                          <i\n                            class=\"fa fa-trash clickable-icon\"\n                            @click=\"deleteHandle(file.id, image)\"\n                          ></i>\n                          <div class=\"page-no pull-right\">{{imgKey + 1}}</div>\n                        </div>\n                      </div>\n                    </b-collapse>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <div class=\"d-flex justify-content-end flex-wrap pt-4\">\n              <button\n                class=\"btn btn-outline-primary min-width-124px m-1\"\n                v-on:click=\"moveBackPage()\"\n              >{{ $t(\"docsign.back\") }}</button>\n              <button\n                class=\"btn btn-primary min-width-124px m-1\"\n                v-on:click=\"moveNextPage()\"\n                style=\"position: relative\"\n              >\n                <i\n                  v-if=\"nextLoading\"\n                  class=\"fa fa-spinner fa-spin fa-3x\"\n                  style=\"position: absolute; top: 0; left: 33%;\"\n                />\n                {{ $t(\"docsign.next\") }}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport \"bootstrap/dist/js/bootstrap.min.js\";\nimport \"bootstrap-multiselect/dist/css/bootstrap-multiselect.css\";\n\nimport { mapGetters } from \"vuex\";\nimport UserIcon from \"../../components/UserIcon\";\nimport UserSelect from \"../../components/UserSelect\";\nimport {\n  GET_DOCUMENT_REQUEST,\n  GET_BLOD_FROM_URL,\n  ADD_ANNTATION,\n  GET_ANNTATION,\n  EDIT_ANNTATION,\n  DELETE_ANNTATION,\n  ADD_ROTATE_DOCUMENTS,\n  ADD_DELETE_DOCUMENTS\n} from \"../../store/modules/document\";\nimport store from \"../../store/store\";\nimport { GET_DOCS } from \"../../store/actions.type\";\nimport pdf from \"vue-pdf\";\nimport draggable from \"vuedraggable\";\nimport { addParamsToBlob } from \"../../helpers\";\nimport {\n  prepareHandle,\n  generalDefaultButton,\n  initialPrepare,\n  history,\n  unredoButton,\n  userSideBarHandle,\n  addCommentToDocument,\n  rotateFunction,\n  deleteSuccessHandle\n} from \"../../helpers/prepareHandle\";\nimport config from \"../../config/config\";\nimport { EventBus } from \"../../config/event-bus\";\n\nexport default {\n  name: \"Prepare\",\n  components: {\n    pdf,\n    UserIcon,\n    UserSelect,\n    draggable\n  },\n  computed: {\n    ...mapGetters([\"addDocument\", [GET_DOCUMENT_REQUEST], \"getRecipients\"])\n  },\n  data() {\n    return {\n      documentList: [],\n      pages: [],\n      sign_items: [],\n      percent: \"100%\",\n      viewSrc: null,\n      viewPage: 0,\n      currentPage: 0,\n      pageCount: 0,\n      src: null,\n      numPages: undefined,\n      annotations: [],\n      pageLoading: true,\n      nextLoading: false,\n      commentButtonActive: false,\n      recipientsList: []\n    };\n  },\n  mounted() {\n    let vm = this;\n    let backendUrl = `${config.BASE_URL}`;\n    let document_id = vm.$route.query.document_id;\n    vm.pages = [];\n    vm.documentList = [];\n\n    store\n      .dispatch(GET_DOCS, document_id)\n      .then(res => {\n        vm.recipientsList = vm.getRecipients;\n      })\n      .catch(err => {});\n\n    store.dispatch(GET_ANNTATION, document_id).then(res => {\n      if (res.status && res.annotations && res.annotations.length > 0) {\n        vm.annotations = res.annotations;\n        EventBus.$on(\"recipientsList\", recipients => {\n          this.recipientsList = recipients;\n          recipients &&\n            generalDefaultButton(vm.annotations, recipients, this.prepareEvent);\n        });\n      }\n    });\n\n    this.initialFunction();\n  },\n  methods: {\n    initialFunction() {\n      let vm = this;\n      let backendUrl = `${config.BASE_URL}`;\n      let document_id = vm.$route.query.document_id;\n      vm.pages = [];\n      vm.documentList = [];\n\n      store\n        .dispatch(GET_DOCUMENT_REQUEST, { document_id, show_image: 1 })\n        .then(res => {\n          vm.documentList = vm[GET_DOCUMENT_REQUEST];\n          if (\n            vm.documentList &&\n            vm.documentList.data &&\n            vm.documentList.data.length > 0\n          ) {\n            vm.documentList.data.map((v, docKey) => {\n              v.images = v.images &&\n                v.images.length > 0 &&\n                v.images.filter((img, imgKey) => {\n                  let checkPageDelete =\n                    v.document_action.length > 0 &&\n                    v.document_action.find(\n                      ac => ac.page === imgKey + 1 && ac.delete === 1\n                    );\n                  !checkPageDelete && vm.pages.push({\n                    docId: v.id,\n                    pageId: docKey,\n                    pageNum: this.numpage(img),\n                    image: img\n                  });   \n                  return !checkPageDelete;\n                  \n                });\n            });\n            vm.pageLoading = false;\n            initialPrepare(vm.pages);\n            // general drop\n            prepareHandle(\n              vm.pages.map((v, key) => key),\n              this.recipientsList,\n              this.prepareEvent\n            );\n          }\n        // console.log('vm.documentList.data', vm.documentList.data[0])\n        // console.log('vm.pages', vm.pages)\n\n        });\n      vm.$root.$on(\"bv::scrollspy::activate\", vm.onActivate);\n    },\n    deleteHandle(docId, imgUrl) {\n      let numPage = this.numpage(imgUrl);\n      if(numPage) {\n        this.pageLoading = false;\n        let sendData = {\n          document_id: docId,\n          page: numPage,\n          delete: 1\n        };\n        this.$store.dispatch(ADD_DELETE_DOCUMENTS, sendData).then(res => {\n          if (res.status) {\n            this.pageLoading = true;\n            deleteSuccessHandle(docId, numPage);\n            this.initialFunction();\n          }\n        });\n      }\n    },\n    numpage(imgUrl) {\n      let arrayImgUrl = imgUrl.split(\"/\").pop();\n      return parseInt(arrayImgUrl.split(\".\")[0].slice(-1));\n    },\n    checkHasDeletePage(document_action, pageId) {\n      let _result =\n        document_action.length > 0 &&\n        document_action.find(v => v.page === pageId && v.delete === 1);\n      return !!_result;\n    },\n    rotateHandle(location, docId, pageId) {\n      let vm = this;\n\n      rotateFunction(location, docId, pageId, sendData => {\n        vm.$store.dispatch(ADD_ROTATE_DOCUMENTS, sendData);\n      });\n    },\n    checkRotate(data, document) {\n      let getRotate =\n        document &&\n        document.document_action &&\n        document.document_action.length > 0 &&\n        document.document_action.find(v => v.page === data.pageNum + 1);\n      return getRotate && getRotate.rotate;\n    },\n    undo() {\n      let vm = this;\n      let document_id = vm.$route.query.document_id;\n      history.undo(vm.annotations);\n      if (history && history.restore_state && history.restore_state.id) {\n        const annotations_id = history.restore_state.id;\n        unredoButton(annotations_id, \"undo\");\n        vm.$store\n          .dispatch(EDIT_ANNTATION, { id: annotations_id, display: \"none\" })\n          .then(res => {\n            if (res.status && res.annotation_id) {\n              vm.$store.dispatch(GET_ANNTATION, document_id).then(res => {\n                if (\n                  res.status &&\n                  res.annotations &&\n                  res.annotations.length > 0\n                ) {\n                  vm.annotations = res.annotations;\n                }\n              });\n            }\n          });\n      }\n    },\n    redo() {\n      let vm = this;\n      let document_id = vm.$route.query.document_id;\n      history.redo();\n      if (history && history.restore_state && history.restore_state.id) {\n        const annotations_id = history.restore_state.id;\n        unredoButton(annotations_id, \"redo\");\n        vm.$store\n          .dispatch(EDIT_ANNTATION, { id: annotations_id, display: \"block\" })\n          .then(res => {\n            if (res.status && res.annotation_id) {\n              vm.$store.dispatch(GET_ANNTATION, document_id).then(res => {\n                if (\n                  res.status &&\n                  res.annotations &&\n                  res.annotations.length > 0\n                ) {\n                  vm.annotations = res.annotations;\n                }\n              });\n            }\n          });\n      }\n    },\n    commentsHandle() {\n      addCommentToDocument(\n        this.pages.map((v, key) => key),\n        this.recipientsList,\n        this.prepareEvent\n      );\n    },\n    changePercent(e) {\n      this.percent = e;\n      var zoomScale = Number(parseInt(e.replace(\"%\", \"\"))) / 100;\n      for (\n        var i = 0;\n        i < document.getElementsByClassName(\"droppable_content\").length;\n        i++\n      ) {\n        this.setZoom(\n          zoomScale,\n          document.getElementsByClassName(\"droppable_content\")[i]\n        );\n      }\n    },\n    setZoom(zoom, el) {\n      var transformOrigin = [0, 0];\n      el = el || instance.getContainer();\n      var p = [\"webkit\", \"moz\", \"ms\", \"o\"],\n        s = \"scale(\" + zoom + \")\",\n        oString =\n          transformOrigin[0] * 100 + \"% \" + transformOrigin[1] * 100 + \"%\";\n\n      for (var i = 0; i < p.length; i++) {\n        el.style[p[i] + \"Transform\"] = s;\n        el.style[p[i] + \"TransformOrigin\"] = oString;\n      }\n\n      el.style[\"transform\"] = s;\n      el.style[\"transformOrigin\"] = oString;\n      el.style[\"height\"] = \"auto\";\n      el.childNodes[0].style[\"height\"] = \"auto\";\n    },\n    onActivate(target) {\n      // console.log(\"target\", target);\n    },\n    selectPage(data, imgKey) {\n      let scrollId = `doc_id_${data.id}_${imgKey}`;\n      var scrollTo = document.getElementById(scrollId);\n      scrollTo.scrollIntoView();\n    },\n    moveNextPage() {\n      if (!this.checkUserTool()) {\n        this.$awn.alert(\"Add at least 1 tool\", {\n          position: \"bottom-left\",\n          labels: {\n            alert: \"Danger Message\"\n          }\n        });\n        return false;\n      }\n      this.nextLoading = true;\n      this.$router.push(\n        \"/docu-sign/review?document_id=\" + this.$route.query.document_id\n      );\n    },\n    checkUserTool() {\n      return $(`div[id^='droppable_content_'] .user-drag`).length > 0;\n    },\n    moveBackPage() {\n      this.$router.push(\n        \"/docu-sign/add-recipients?document_id=\" + this.$route.query.document_id\n      );\n    },\n    addRecipient() {\n      this.recipients.push({\n        sign_type: \"Need to sign\",\n        com_type: false,\n        name: \"\",\n        email: \"\",\n        set_password: false,\n        password: \"\",\n        confirm_password: \"\"\n      });\n    },\n    removeRecipient(index) {\n      this.recipients.splice(index, 1);\n    },\n    prepareEvent(data, element) {\n      const vm = this,\n        document_id = vm.$route.query.document_id;\n      let sendData = data.send_data;\n      sendData.annotation_id = document_id;\n      data.annotation_id && (sendData.id = data.annotation_id);\n\n      var checkElemnts = $(\".tool-sign:hidden\");\n      vm.$store.dispatch(ADD_ANNTATION, sendData).then(res => {\n        let get_annotation_id = element.data(\"annotation_id\");\n        if (res.status && res.annotation_id && !get_annotation_id) {\n          if (\n            !sendData.id &&\n            history.redo_list &&\n            history.redo_list.length > 0\n          ) {\n            history.redo_list.map((val, key) => {\n              let annotation_id = val.id;\n              vm.$store.dispatch(DELETE_ANNTATION, annotation_id).then(res => {\n                checkElemnts[key].remove();\n              });\n            });\n          }\n          element.attr(\"data-annotation_id\", res.annotation_id);\n          element.addClass(\"tool-sign tool_sign_\" + res.annotation_id);\n        }\n        if (sendData.text && sendData.recipient_arr) {\n          element.popover(\"hide\");\n          element.css(\"opacity\", 0.5);\n        }\n        vm.$store.dispatch(GET_ANNTATION, document_id).then(res2 => {\n          if (res2.status && res2.annotations && res2.annotations.length > 0) {\n            vm.annotations = res2.annotations;\n          }\n        });\n      });\n    }\n  },\n  created() {}\n};\n</script>\n\n<style lang=\"scss\">\n@import \"./Prepare.scss\";\n</style>\n\n"]}]}