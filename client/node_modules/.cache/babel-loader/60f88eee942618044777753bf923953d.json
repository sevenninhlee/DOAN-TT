{"remainingRequest":"/var/www/html/Jobs/DOAN-TT/client/node_modules/babel-loader/lib/index.js!/var/www/html/Jobs/DOAN-TT/client/src/helpers/prepareHandle.js","dependencies":[{"path":"/var/www/html/Jobs/DOAN-TT/client/src/helpers/prepareHandle.js","mtime":1573548264992},{"path":"/var/www/html/Jobs/DOAN-TT/client/node_modules/cache-loader/dist/cjs.js","mtime":1571633391755},{"path":"/var/www/html/Jobs/DOAN-TT/client/node_modules/babel-loader/lib/index.js","mtime":1571304325577}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport _defineProperty from \"/var/www/html/Jobs/DOAN-TT/client/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.array.find\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { omit } from \"lodash\"; // config\n\nvar marginDefault = 15;\n\nvar resizeOption = function resizeOption(callback) {\n  return {\n    maxHeight: 100,\n    minHeight: 35,\n    maxWidth: 200,\n    minWidth: 145,\n    stop: function stop(event, ui) {\n      callback && callback(event, ui);\n    }\n  };\n};\n\nvar zIndexDefault = 1111;\nvar userToolList = null;\nvar addCommentButton = null;\nvar firstPageLoading = true;\nvar DATA_COMMENT_TYPE = 'comments';\nvar DATA_TEXT_TYPE = 'text';\nvar droppableContent = \"droppable_content_\";\nvar documentContainer = \"document_container\";\nvar documentID = \"doc_id_\";\n\nvar commentFormElement = function commentFormElement(recipientsList) {\n  var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var annotation_id = arguments.length > 2 ? arguments[2] : undefined;\n  return \"\\n  <div class=\\\"hiddenCommentForm display_none\\\">\\n    <form class=\\\"commentForm_\".concat(annotation_id, \" hiddenForm\\\">\\n      <div class=\\\"form-group\\\">\\n        <textarea type=\\\"email\\\" class=\\\"form-control\\\" name=\\\"comments\\\" placeholder=\\\"Comment\\\" rows=\\\"5\\\" required>\").concat(data.text || '', \"</textarea>\\n      </div>\\n      <div class=\\\"form-group multiselectForm\\\">\\n        <select class=\\\"form-control multiselect\\\" multiple=\\\"multiple\\\" name=\\\"recipients\\\">\\n          \").concat(recipientsList.map(function (v) {\n    return \"<option value=\\\"\".concat(v.id, \"\\\" \").concat(data.recipient_arr && JSON.parse(\"[\".concat(data.recipient_arr, \"]\")).find(function (a) {\n      return a === v.id;\n    }) && 'selected', \">\").concat(v.name, \"</option>\");\n  }), \"\\n        </select>\\n      </div>\\n      <div class=\\\"text-center\\\">\\n        <button type=\\\"submit\\\" class=\\\"btn btn-primary\\\">Save</button>\\n      </div>\\n    </form>\\n  </div>\\n\");\n};\n\nvar commentElement = function commentElement(recipientsList, data, annotation_id) {\n  return \"\\n  <div \".concat(!annotation_id && \"id=\\\"addCommentElement\\\"\", \" data-type=\\\"\").concat(DATA_COMMENT_TYPE, \"\\\" \").concat(annotation_id && \"data-annotation_id=\\\"\".concat(annotation_id, \"\\\"\"), \">\\n    <i class=\\\"fa fa-comment\\\" aria-hidden=\\\"true\\\"></i>\\n    \").concat(commentFormElement(recipientsList, data, annotation_id), \"\\n  </div>  \\n\");\n};\n\nvar _currentRotateDegree = 0;\nvar defaultJump = 90;\nexport function deleteSuccessHandle(docId, pageId) {\n  console.log(docId, pageId);\n\n  var _page_doc_nav_id = $(\"#doc_nav_id_\".concat(docId, \"_\").concat(pageId));\n\n  _page_doc_nav_id.parent().addClass('d-none');\n\n  var _page_doc_id = $(\"#\".concat(documentID).concat(docId, \"_\").concat(pageId));\n\n  _page_doc_id.parent().addClass('d-none');\n}\nexport function rotateFunction(location, docId, pageId, callback) {\n  var _documentContainer = $(\"#\".concat(documentContainer));\n\n  var _documentContainerWidth = _documentContainer.width() - 10;\n\n  var _imagesElement = $(\"#\".concat(documentID).concat(docId, \"_\").concat(pageId, \" img\"));\n\n  location === 'left' ? _currentRotateDegree -= defaultJump : _currentRotateDegree += defaultJump;\n  _currentRotateDegree > defaultJump * 2 && (_currentRotateDegree = -defaultJump);\n  _currentRotateDegree < -(defaultJump * 2) && (_currentRotateDegree = defaultJump);\n\n  var _translate = _currentRotateDegree === defaultJump ? 'translateY(-20%)' : _currentRotateDegree === -defaultJump ? 'translateY(20%)' : '';\n\n  var _height = _currentRotateDegree === -defaultJump || _currentRotateDegree === defaultJump ? _documentContainerWidth : 'auto'; // console.log(_currentRotateDegree)\n\n\n  _imagesElement.each(function (k) {\n    var _image = $(_imagesElement[k]);\n\n    _image.css({\n      // display: 'block',\n      // transformOrigin: 'top left',\n      transform: \"rotate(\".concat(_currentRotateDegree, \"deg) \").concat(_translate),\n      height: _height\n    });\n\n    _currentRotateDegree === -defaultJump || _currentRotateDegree === defaultJump ? _image.addClass('w-auto') : _image.removeClass('w-auto');\n  }); // save data to server\n\n\n  var sendData = {\n    document_id: docId,\n    page: pageId + 1,\n    rotate: _currentRotateDegree,\n    delete: 0\n  };\n  callback(sendData);\n}\nexport function addCommentToDocument(pagesNumber, recipientsList, callback) {\n  userToolList = null;\n  var defaultData = {\n    text: '',\n    recipient_arr: recipientsList.map(function (v) {\n      return v.id;\n    }).join()\n  };\n  addCommentButton = commentElement(recipientsList, defaultData);\n  $(document).ready(function () {\n    // =======\n    // click add tool\n    // =======\n    $(\"div[id^=\\\"\".concat(droppableContent, \"\\\"]\")).click(function (e) {\n      if (addCommentButton) {\n        var currentTarget = $(e.currentTarget);\n        var page_num = currentTarget.data(\"page_num\");\n        var addNewToolToContent = $(addCommentButton).clone();\n        var element_style = {\n          position: 'absolute',\n          left: e.originalEvent.layerX,\n          top: e.originalEvent.layerY,\n          zIndex: zIndexDefault\n        };\n        addNewToolToContent.addClass(\"user-drag on-user-drag drag-success user-can-delete addCommentElement\");\n        addNewToolToContent.css(element_style);\n        addNewToolToContent.removeAttr('id');\n        addNewToolToContent.appendTo(currentTarget);\n        addNewToolToContent.removeClass(\"on-user-drag ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable defaultResize\");\n        addNewToolToContent.draggable({\n          cursor: \"move\",\n          revert: \"invalid\",\n          zIndex: zIndexDefault,\n          delay: 200\n        }); // save position\n\n        sendCallback(addNewToolToContent, page_num, DATA_COMMENT_TYPE, callback, recipientsList.map(function (v) {\n          return v.id;\n        }).join()); // Toggle Comment Form \n\n        handleCommentForm(addNewToolToContent, callback); // remove active class tool\n\n        addCommentButton = null;\n        var checkHasElement = $(\"#\".concat(documentContainer, \" .temporaryTool\"));\n        checkHasElement.remove();\n      }\n    }); // ========\n    // add tool to mouse when tool available\n    // ========\n\n    var $droppableContent = $(\"div[id^=\\\"\".concat(droppableContent, \"\\\"]\"));\n    var $documentContainer = $(\"#\".concat(documentContainer));\n    $droppableContent.on('mousemove', function (e) {\n      if (addCommentButton) {\n        var addNewToolToContent = $(addCommentButton).clone();\n        var element_style = {\n          position: 'absolute',\n          left: e.originalEvent.pageX - $documentContainer.offset().left + marginDefault,\n          top: e.originalEvent.pageY - $documentContainer.offset().top + marginDefault,\n          zIndex: zIndexDefault\n        };\n        var checkHasElement = $(\"#\".concat(documentContainer, \" #\").concat($(addNewToolToContent).attr('id')));\n        checkHasElement.length === 0 && addNewToolToContent.appendTo($(\"#\".concat(documentContainer)));\n        $(checkHasElement).css(element_style);\n        $(checkHasElement).addClass('temporaryTool');\n        $droppableContent.mouseout(function () {\n          var checkHasElement = $(\"#\".concat(documentContainer, \" .temporaryTool\"));\n          checkHasElement.remove();\n        });\n      }\n    });\n  });\n}\nexport function generalDefaultButton(annotations, recipientsList, callback) {\n  annotations.map(function (annotation, key) {\n    if (annotation.type === DATA_TEXT_TYPE) {\n      // left button\n      var recipient = recipientsList.filter(function (v) {\n        return annotation.actor_id === v.id;\n      });\n      annotation.actor = recipient && recipient.length > 0 && recipient[0];\n      var tool = prepareTools.find(function (v) {\n        return v.name === annotation.type_tools;\n      });\n      var page_num = annotation.page_num;\n\n      var _dropableContentId = \"\".concat(droppableContent).concat(page_num);\n\n      var element_style = \"position: absolute; color: \".concat(annotation.actor.color, \"; background: #fff; border: 1px solid \").concat(annotation.actor.color, \"; left: \").concat(annotation.pos_x, \"px; top: \").concat(annotation.pos_y, \"px; z-index: 1111; width: 143px; height: 31px;\");\n      var new_element = \"\\n        <span\\n          data-color='\".concat(annotation.actor && annotation.actor.color, \"'\\n          data-tool='\").concat(addDataToElement(annotation.creator_id, annotation.actor, tool), \"'\\n          data-annotation_id='\").concat(annotation.id, \"'\\n          class='user-drag drag-success user-can-delete tool-sign tool_sign_\").concat(annotation.id, \"'\\n          style='\").concat(element_style, \"'\\n        >\\n          <i class=\\\"\").concat(tool.icon, \"\\\" />\\n          <span>\").concat(tool.label, \"</span>\\n        </span>\\n      \");\n      new_element = $($.parseHTML(new_element)[1]);\n      new_element.detach().appendTo(\"#\".concat(_dropableContentId));\n      new_element.resizable().resizable('destroy');\n      new_element.resizable(resizeOption(function () {\n        sendCallback(new_element, page_num, callback);\n      }));\n    } else if (annotation.type === DATA_COMMENT_TYPE) {\n      // comment button\n      var _page_num = annotation.page_num;\n\n      var _dropableContentId2 = \"\".concat(droppableContent).concat(_page_num);\n\n      var _new_element = commentElement(recipientsList, annotation, annotation.id);\n\n      _new_element = $($.parseHTML(_new_element)[1]);\n      var _element_style = {\n        position: 'absolute',\n        left: annotation.pos_x,\n        top: annotation.pos_y,\n        zIndex: zIndexDefault\n      };\n\n      _new_element.addClass(\"user-drag drag-success user-can-delete tool-sign tool_sign_\".concat(annotation.id, \" addCommentElement\"));\n\n      _new_element.css(_element_style);\n\n      _new_element.detach().appendTo(\"#\".concat(_dropableContentId2)); // Toggle Comment Form \n\n\n      handleCommentForm(_new_element, callback);\n    }\n  });\n}\nexport function unredoButton(id, type) {\n  type === \"undo\" ? $(\".tool_sign_\" + id).hide() : $(\".tool_sign_\" + id).show();\n}\n\nfunction addDataToElement(creator_id, item, tool) {\n  return JSON.stringify(_objectSpread({}, omit(item, [\"children\", \"pivot\", \"phone\", \"password\", \"created_at\", \"updated_at\"]), {\n    tool: _objectSpread({}, tool),\n    clientId: creator_id\n  }));\n}\n\nexport function initialPrepare(pages) {\n  $(document).ready(function () {\n    pages.map(function (page, index) {\n      var _page_doc_id = \"#\".concat(documentID).concat(page.docId, \"_\").concat(page.pageNum);\n\n      var _page_doc_nav_id_ = \"#doc_nav_id_\".concat(page.docId, \"_\").concat(page.pageNum);\n\n      if (firstPageLoading) {\n        // =======\n        // loading image\n        // =======\n        // loader content page\n        $(\"\".concat(_page_doc_id, \" .loader_img\")).show();\n        $(\"\".concat(_page_doc_id, \" .main_img\")).on('load', function () {\n          $(\"\".concat(_page_doc_id, \" .loader_img\")).hide();\n        }); // loader nav page\n\n        $(\"\".concat(_page_doc_nav_id_, \" .loader_img\")).show();\n        $(\"\".concat(_page_doc_nav_id_, \" .main_img\")).on('load', function () {\n          $(\"\".concat(_page_doc_nav_id_, \" .loader_img\")).hide();\n        }); // end loading image\n      } else {\n        $(\"\".concat(_page_doc_id, \" .loader_img\")).hide();\n        $(\"\".concat(_page_doc_nav_id_, \" .loader_img\")).hide();\n      } // default rotate page\n\n\n      var _documentContainer = $(\"#\".concat(documentContainer));\n\n      var _documentContainerWidth = _documentContainer.width() - 10;\n\n      var _docIdElement = $(\"#\".concat(documentID).concat(page.docId, \"_\").concat(page.pageNum));\n\n      var defaultRotate = _docIdElement.parent().data('rotate') || 0;\n\n      var _height = defaultRotate === -defaultJump || defaultRotate === defaultJump ? _documentContainerWidth : 'auto';\n\n      var _translate = defaultRotate === defaultJump ? 'translateY(-20%)' : defaultRotate === -defaultJump ? 'translateY(20%)' : '';\n\n      var _imagesElement = _docIdElement.children('img');\n\n      _imagesElement.css({\n        transform: \"rotate(\".concat(defaultRotate, \"deg) \").concat(_translate),\n        height: _height\n      });\n\n      defaultRotate === -defaultJump || defaultRotate === defaultJump ? _imagesElement.addClass('w-auto') : _imagesElement.removeClass('w-auto');\n    });\n    firstPageLoading = false;\n  });\n}\nexport function prepareHandle(pagesNumber, recipientsList, callback) {\n  $(document).ready(function () {\n    // =======\n    // click add tool\n    // =======\n    $(\"div[id^=\\\"\".concat(droppableContent, \"\\\"]\")).click(function (e) {\n      if (userToolList) {\n        var currentTarget = $(e.currentTarget);\n        var page_num = currentTarget.data(\"page_num\");\n        var addNewToolToContent = $(userToolList).clone();\n        var element_style = {\n          position: 'absolute',\n          color: addNewToolToContent.data(\"color\"),\n          border: \"1px solid \".concat(addNewToolToContent.data(\"color\")),\n          background: \"#fff\",\n          left: e.originalEvent.layerX,\n          top: e.originalEvent.layerY + marginDefault,\n          zIndex: zIndexDefault\n        };\n        addNewToolToContent.addClass(\"user-drag on-user-drag drag-success user-can-delete\");\n        addNewToolToContent.css(element_style);\n        addNewToolToContent.removeAttr('id');\n        addNewToolToContent.appendTo(currentTarget);\n        appendElementToDoc(addNewToolToContent, page_num, DATA_TEXT_TYPE, callback); // remove active class tool\n\n        var oldToolList = $(userToolList).parent();\n\n        if (oldToolList.length > 0 && $(oldToolList) && $(oldToolList).hasClass('active')) {\n          $(oldToolList).removeClass('active');\n          userToolList = null;\n        }\n\n        var checkHasElement = $(\"#\".concat(documentContainer, \" .temporaryTool\"));\n        checkHasElement.remove();\n      }\n    }); // ========\n    // add tool to mouse when tool available\n    // ========\n\n    var $droppableContent = $(\"div[id^=\\\"\".concat(droppableContent, \"\\\"]\"));\n    var $documentContainer = $(\"#\".concat(documentContainer));\n    $droppableContent.on('mousemove', function (e) {\n      if (userToolList) {\n        var addNewToolToContent = $(userToolList).clone();\n        var element_style = {\n          position: 'absolute',\n          color: addNewToolToContent.data(\"color\"),\n          border: \"1px solid \".concat(addNewToolToContent.data(\"color\")),\n          background: '#fff',\n          left: e.originalEvent.pageX - $documentContainer.offset().left + marginDefault,\n          top: e.originalEvent.pageY - $documentContainer.offset().top + marginDefault,\n          // left: e.originalEvent.layerX + marginDefault,\n          // top: e.originalEvent.layerY + marginDefault,\n          zIndex: zIndexDefault,\n          padding: '1px 6px',\n          borderRadius: 3,\n          opacity: 0.5,\n          transition: '0.01s'\n        };\n        var checkHasElement = $(\"#\".concat(documentContainer, \" #\").concat($(addNewToolToContent).attr('id')));\n        checkHasElement.length === 0 && addNewToolToContent.appendTo($(\"#\".concat(documentContainer)));\n        $(checkHasElement).css(element_style);\n        $(checkHasElement).addClass('temporaryTool');\n        $droppableContent.mouseout(function () {\n          var checkHasElement = $(\"#\".concat(documentContainer, \" .temporaryTool\"));\n          checkHasElement.remove();\n        });\n      }\n    }); // ========\n    // dropable tool\n    // ========\n\n    addUserDrag(pagesNumber, recipientsList, callback);\n  });\n}\n\nfunction addUserDrag(pagesNumber, recipientsList, callback) {\n  pagesNumber && pagesNumber.length > 0 && pagesNumber.map(function (page_num) {\n    page_num = page_num + 1; //Make element draggable\n\n    var x = null,\n        _dropableContentId = \"\".concat(droppableContent).concat(page_num);\n\n    $(\"#\".concat(_dropableContentId)).droppable({\n      accept: \".user-drag\",\n      activeClass: \"user-drop-area\",\n      out: function out(event, ui) {\n        var _getType = ui.helper.data(\"type\");\n\n        if (_getType !== DATA_COMMENT_TYPE) {\n          $(ui.helper).css({\n            \"color\": \"#555\",\n            background: \"#fff\",\n            border: \"1px solid #999\"\n          });\n        }\n      },\n      over: function over(event, ui) {\n        var _getColor = ui.helper.data(\"color\");\n\n        var _getType = ui.helper.data(\"type\");\n\n        if (_getType !== DATA_COMMENT_TYPE) {\n          $(ui.helper).css({\n            \"color\": _getColor,\n            background: \"#fff\",\n            border: \"1px solid \".concat(_getColor)\n          });\n        }\n      },\n      drop: function drop(e, ui) {\n        var _uiDraggableId = $(ui.draggable)[0].id; // change position\n\n        var x = ui.helper.clone();\n\n        var _getLeftElement = x.css(\"left\").replace(\"px\", \"\") || 0,\n            _getTopElement = x.css(\"top\").replace(\"px\", \"\") || 0;\n\n        _getLeftElement = parseInt(_getLeftElement);\n        _getTopElement = parseInt(_getTopElement);\n\n        var __top = ui.offset.top - $(this).offset().top;\n\n        x.css(\"left\", Math.abs((_uiDraggableId ? 200 : 0) - _getLeftElement));\n        x.css(\"top\", Math.abs(__top)); // first time\n\n        if (_uiDraggableId !== \"\") {\n          ui.helper.remove(); // add draggable, resize \n\n          appendElementToDoc(x, page_num, DATA_TEXT_TYPE, callback);\n        } // second time\n        else {\n            var _getType = ui.helper.data(\"type\");\n\n            ui.helper.remove();\n            $(ui.draggable).remove(); // add draggable, resize \n\n            var _data_type = _getType === DATA_COMMENT_TYPE ? DATA_COMMENT_TYPE : DATA_TEXT_TYPE;\n\n            appendElementToDoc(x, page_num, _data_type, callback, true); // Toggle Comment Form \n\n            if (_getType === DATA_COMMENT_TYPE) {\n              console.log('comment move');\n              console.log(x.data('annotation_id'));\n              x.append(commentFormElement(recipientsList, x.data('annotation_id')));\n              hiddenCommentFormFunc();\n              handleCommentForm(x, callback, true);\n            }\n          }\n      }\n    });\n  });\n}\n\nfunction appendElementToDoc(x, page_num, type, callback) {\n  var isSecondTime = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : false;\n\n  var _dropableContentId = \"\".concat(droppableContent).concat(page_num);\n\n  x.removeClass(\"on-user-drag ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable defaultResize\");\n  x.addClass(\"drag-success user-can-delete\");\n  x.draggable({\n    cursor: \"move\",\n    revert: \"invalid\",\n    zIndex: zIndexDefault,\n    delay: 200,\n    stop: function stop(event, ui) {\n      var _getColor = ui.helper.data(\"color\");\n\n      $(ui.helper).css({\n        \"color\": _getColor,\n        background: \"#fff\",\n        border: \"1px solid \".concat(_getColor)\n      });\n      $(\".remove-user-drag\").removeClass('remove-user-drag-hover');\n    },\n    drag: function drag(event, ui) {\n      $(ui.helper).addClass(\"on-user-drag\");\n      $(\".remove-user-drag\").addClass('remove-user-drag-hover ');\n    }\n  });\n  type === DATA_TEXT_TYPE && x.resizable(resizeOption(function () {\n    sendCallback(x, page_num, type, callback);\n  }));\n  x.detach().appendTo(\"#\".concat(_dropableContentId));\n\n  if (isSecondTime && type === DATA_TEXT_TYPE) {\n    x.resizable('destroy');\n    x.resizable(resizeOption(function () {\n      sendCallback(x, page_num, type, callback);\n    }));\n  }\n\n  sendCallback(x, page_num, type, callback);\n}\n\nfunction sendCallback(x, page_num, type, callback, recipient_arr, text) {\n  var _dropableContentId = $(\"#\".concat(droppableContent).concat(page_num));\n\n  var _getDataTool = x.data(\"tool\") || {},\n      _getDataAnnotationId = x.data(\"annotation_id\"),\n      _getPosition = x.position(),\n      _getWidth = x.width() + 20,\n      _getHeight = x.height() + 10,\n      _getPageWidth = _dropableContentId.first().width(),\n      _getPageHeight = _dropableContentId.first().height();\n\n  callback(_objectSpread({}, _getDataTool, {\n    annotation_id: _getDataAnnotationId || null,\n    send_data: {\n      actor_id: _getDataTool.id || 0,\n      page_num: page_num,\n      doc_id: _dropableContentId.data(\"doc_id\"),\n      width: _getPageWidth && _getPageWidth.toFixed(0),\n      height: _getPageHeight && _getPageHeight.toFixed(0),\n      pos_x: _getPosition.left && _getPosition.left.toFixed(0),\n      pos_y: _getPosition.top && _getPosition.top.toFixed(0),\n      size_w: _getWidth && _getWidth.toFixed(0),\n      size_h: _getHeight && _getHeight.toFixed(0),\n      alpha: 1,\n      text: text,\n      font_family: '',\n      font_size: 12,\n      font_weight: 'N',\n      font_color: '000000',\n      type_tools: _getDataTool.tool && _getDataTool.tool.name || type,\n      type: type,\n      recipient_arr: recipient_arr // creator_id: _getDataTool.clientId,\n\n    }\n  }), x);\n}\n\nfunction hiddenCommentFormFunc() {\n  $(\".popover\").popover('hide');\n  $(\".addCommentElement\").css({\n    'opacity': 0.5,\n    zIndex: zIndexDefault\n  });\n}\n\nfunction handleCommentForm(parentElement, callback) {\n  var isSecondTime = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var annotation_id = parentElement.data(\"annotation_id\");\n  parentElement.popover({\n    html: true,\n    container: parentElement.parent(),\n    content: parentElement.children('.hiddenCommentForm') //.clone(),\n\n  });\n  $(\"div[id^=\\\"\".concat(droppableContent, \"\\\"] .addCommentElement\")).on(\"click\", function (e) {\n    var currentTarget = $(e.currentTarget);\n    currentTarget.css({\n      'opacity': 1,\n      zIndex: 9999\n    });\n  }); // add multiselect\n\n  if (!isSecondTime) {\n    $(\".commentForm_\".concat(annotation_id, \" .multiselect\")).multiselect({\n      allSelectedText: 'All Recipients',\n      includeSelectAllOption: true\n    });\n  } // submit comment\n\n\n  $(\".commentForm_\".concat(annotation_id)).on('submit', function (e) {\n    var formValue = $(\".commentForm_\".concat(annotation_id)).serializeArray();\n    var newValue = mergeArraySameObjectValue(formValue);\n    var page_num = parentElement.parent().data(\"page_num\");\n    sendCallback(parentElement, page_num, DATA_COMMENT_TYPE, callback, newValue[1].value.join(), newValue[0].value.join());\n    e.preventDefault();\n  });\n}\n\nexport function userSideBarHandle(callback) {\n  $(document).ready(function () {\n    var userDrag = $(\".user-item .tool\");\n    userDrag.click(function (e) {\n      userDrag.hasClass('active') && userDrag.removeClass('active'); // remove or add active class\n\n      var currentTarget = $(e.currentTarget);\n\n      if (!currentTarget.hasClass('active')) {\n        currentTarget.addClass(\"active\");\n      } else {\n        currentTarget.removeClass(\"active\");\n        userToolList = null;\n      } // set copy when click\n\n\n      if (currentTarget.children() && currentTarget.children().length > 0) {\n        userToolList = currentTarget.children()[0];\n        addCommentButton = null;\n      }\n    }); // pagesNumber && pagesNumber.length > 0 && pagesNumber.map(page_num => {\n    // let _dropableContentId = `${droppableContent}${page_num}`;\n    //Make element draggable\n\n    $(\".user-drag\").draggable({\n      helper: \"clone\",\n      cursor: \"move\",\n      tolerance: \"fit\",\n      zIndex: zIndexDefault,\n      // containment: \"div[id^='droppable_content_']\",\n      // containment: \"div[id^='droppable_content_']\",\n      drag: function drag(event, ui) {\n        $(ui.helper).addClass(\"on-user-drag\");\n        userToolList = null;\n      }\n    });\n    $(\".remove-user-drag\").droppable({\n      drop: function drop(event, ui) {\n        var x = ui.helper.clone();\n        userToolList = null;\n        callback(x.data(\"annotation_id\"), ui.draggable); // $(ui.draggable).remove();\n      },\n      // hoverClass: \"remove-user-drag-hover\",\n      accept: \".user-can-delete\"\n    }); // });\n  });\n}\n;\nexport var prepareTools = [{\n  name: \"stamp\",\n  label: \"Stamp\",\n  icon: \"fas fa-stamp\"\n}, {\n  name: \"signature\",\n  label: \"Signature\",\n  icon: \"fa fa-pencil\"\n}, {\n  name: \"full_name\",\n  label: \"Full Name\",\n  icon: \"fa fa-user\"\n}, {\n  name: \"company\",\n  label: \"Company\",\n  icon: \"fa fa-building\"\n}, {\n  name: \"title\",\n  label: \"Title\",\n  icon: \"fa fa-briefcase\"\n}, {\n  name: \"text\",\n  label: \"Text\",\n  icon: \"fa fa-file-text\"\n}, {\n  name: \"date_signed\",\n  label: \"Date Signed\",\n  icon: \"fa fa-calendar\"\n}, {\n  name: \"attachments\",\n  label: \"Attachments\",\n  icon: \"fa fa-paperclip\"\n}];\nvar restore_state = [];\nvar redo_list = [];\nvar undo_list = [];\nexport var history = {\n  restore_state: restore_state,\n  redo_list: redo_list,\n  undo_list: undo_list,\n  saveState: function saveState(restore_state, list, keep_redo) {\n    keep_redo = keep_redo || false;\n\n    if (!keep_redo) {\n      this.redo_list = [];\n    }\n\n    (list || this.undo_list).push(restore_state);\n  },\n  undo: function undo(data) {\n    this.undo_list = data;\n    this.restoreState(this.undo_list, this.redo_list);\n  },\n  redo: function redo() {\n    var data = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    // if(data) {\n    //   this.undo_list = data;\n    //   this.restore_state = data.pop();\n    //   this.redo_list = []\n    // }\n    this.restoreState(this.redo_list, this.undo_list);\n  },\n  restoreState: function restoreState(pop, push) {\n    if (pop.length) {\n      this.restore_state = pop.pop();\n      this.saveState(this.restore_state, push, true);\n    }\n  }\n}; // $('body').on('click', function (e) {\n//   //did not click a popover toggle or popover\n//   if ($(e.target).data('toggle') !== 'popover'\n//     && $(e.target).parents('.popover.in').length === 0) {\n//     // $('.addCommentElement').popover('hide');\n//   }\n// });\n\nfunction mergeArraySameObjectValue(array) {\n  var output = [];\n  array.forEach(function (item) {\n    var existing = output.filter(function (v, i) {\n      return v.name == item.name;\n    });\n\n    if (existing.length) {\n      var existingIndex = output.indexOf(existing[0]);\n      output[existingIndex].value = output[existingIndex].value.concat(item.value);\n    } else {\n      if (typeof item.value == 'string') item.value = [item.value];\n      output.push(item);\n    }\n  });\n  return output;\n}",{"version":3,"sources":["/var/www/html/Jobs/DOAN-TT/client/src/helpers/prepareHandle.js"],"names":["omit","marginDefault","resizeOption","callback","maxHeight","minHeight","maxWidth","minWidth","stop","event","ui","zIndexDefault","userToolList","addCommentButton","firstPageLoading","DATA_COMMENT_TYPE","DATA_TEXT_TYPE","droppableContent","documentContainer","documentID","commentFormElement","recipientsList","data","annotation_id","text","map","v","id","recipient_arr","JSON","parse","find","a","name","commentElement","_currentRotateDegree","defaultJump","deleteSuccessHandle","docId","pageId","console","log","_page_doc_nav_id","$","parent","addClass","_page_doc_id","rotateFunction","location","_documentContainer","_documentContainerWidth","width","_imagesElement","_translate","_height","each","k","_image","css","transform","height","removeClass","sendData","document_id","page","rotate","delete","addCommentToDocument","pagesNumber","defaultData","join","document","ready","click","e","currentTarget","page_num","addNewToolToContent","clone","element_style","position","left","originalEvent","layerX","top","layerY","zIndex","removeAttr","appendTo","draggable","cursor","revert","delay","sendCallback","handleCommentForm","checkHasElement","remove","$droppableContent","$documentContainer","on","pageX","offset","pageY","attr","length","mouseout","generalDefaultButton","annotations","annotation","key","type","recipient","filter","actor_id","actor","tool","prepareTools","type_tools","_dropableContentId","color","pos_x","pos_y","new_element","addDataToElement","creator_id","icon","label","parseHTML","detach","resizable","unredoButton","hide","show","item","stringify","clientId","initialPrepare","pages","index","pageNum","_page_doc_nav_id_","_docIdElement","defaultRotate","children","prepareHandle","border","background","appendElementToDoc","oldToolList","hasClass","padding","borderRadius","opacity","transition","addUserDrag","x","droppable","accept","activeClass","out","_getType","helper","over","_getColor","drop","_uiDraggableId","_getLeftElement","replace","_getTopElement","parseInt","__top","Math","abs","_data_type","append","hiddenCommentFormFunc","isSecondTime","drag","_getDataTool","_getDataAnnotationId","_getPosition","_getWidth","_getHeight","_getPageWidth","first","_getPageHeight","send_data","doc_id","toFixed","size_w","size_h","alpha","font_family","font_size","font_weight","font_color","popover","parentElement","html","container","content","multiselect","allSelectedText","includeSelectAllOption","formValue","serializeArray","newValue","mergeArraySameObjectValue","value","preventDefault","userSideBarHandle","userDrag","tolerance","restore_state","redo_list","undo_list","history","saveState","list","keep_redo","push","undo","restoreState","redo","pop","array","output","forEach","existing","i","existingIndex","indexOf","concat"],"mappings":"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","sourcesContent":["import { omit } from \"lodash\";\n\n// config\nconst marginDefault = 15;\nconst resizeOption = (callback) => {\n  return {\n    maxHeight: 100,\n    minHeight: 35,\n    maxWidth: 200,\n    minWidth: 145,\n    stop(event, ui) {\n      callback && callback(event, ui);\n    }\n  }\n};\n\nconst zIndexDefault = 1111;\nlet userToolList = null;\nlet addCommentButton = null;\nlet firstPageLoading = true;\nconst DATA_COMMENT_TYPE = 'comments';\nconst DATA_TEXT_TYPE = 'text';\n\nconst droppableContent = `droppable_content_`;\nconst documentContainer = `document_container`;\nconst documentID = `doc_id_`;\n\nconst commentFormElement = (recipientsList, data = {}, annotation_id) => `\n  <div class=\"hiddenCommentForm display_none\">\n    <form class=\"commentForm_${annotation_id} hiddenForm\">\n      <div class=\"form-group\">\n        <textarea type=\"email\" class=\"form-control\" name=\"comments\" placeholder=\"Comment\" rows=\"5\" required>${data.text || ''}</textarea>\n      </div>\n      <div class=\"form-group multiselectForm\">\n        <select class=\"form-control multiselect\" multiple=\"multiple\" name=\"recipients\">\n          ${recipientsList.map(v => `<option value=\"${v.id}\" ${data.recipient_arr && JSON.parse(`[${data.recipient_arr}]`).find(a => a === v.id) && 'selected'}>${v.name}</option>`)}\n        </select>\n      </div>\n      <div class=\"text-center\">\n        <button type=\"submit\" class=\"btn btn-primary\">Save</button>\n      </div>\n    </form>\n  </div>\n`;\n\nconst commentElement = (recipientsList, data, annotation_id) => `\n  <div ${!annotation_id && `id=\"addCommentElement\"`} data-type=\"${DATA_COMMENT_TYPE}\" ${annotation_id && `data-annotation_id=\"${annotation_id}\"`}>\n    <i class=\"fa fa-comment\" aria-hidden=\"true\"></i>\n    ${commentFormElement(recipientsList, data, annotation_id)}\n  </div>  \n`;\n\nlet _currentRotateDegree = 0;\nconst defaultJump = 90;\n\nexport function deleteSuccessHandle(docId, pageId) {\n  console.log(docId, pageId)\n  let _page_doc_nav_id = $(`#doc_nav_id_${docId}_${pageId}`);\n  _page_doc_nav_id.parent().addClass('d-none');\n  \n  let _page_doc_id = $(`#${documentID}${docId}_${pageId}`);\n  _page_doc_id.parent().addClass('d-none');\n}\n\nexport function rotateFunction(location, docId, pageId, callback) {\n  let _documentContainer = $(`#${documentContainer}`);\n  let _documentContainerWidth = _documentContainer.width() - 10;\n\n  let _imagesElement = $(`#${documentID}${docId}_${pageId} img`);\n  location === 'left' ? _currentRotateDegree -= defaultJump : _currentRotateDegree += defaultJump;\n\n  _currentRotateDegree > (defaultJump * 2) && (_currentRotateDegree = -defaultJump);\n  _currentRotateDegree < -(defaultJump * 2) && (_currentRotateDegree = defaultJump);\n\n  let _translate = _currentRotateDegree === defaultJump ? 'translateY(-20%)' : _currentRotateDegree === -defaultJump ? 'translateY(20%)' : '';\n  let _height = (_currentRotateDegree === -defaultJump || _currentRotateDegree === defaultJump) ? _documentContainerWidth : 'auto';\n\n  // console.log(_currentRotateDegree)\n  _imagesElement.each(k => {\n    let _image = $(_imagesElement[k]);\n    _image.css({\n      // display: 'block',\n      // transformOrigin: 'top left',\n      transform: `rotate(${_currentRotateDegree}deg) ${_translate}`,\n      height: _height,\n    });\n\n    (_currentRotateDegree === -defaultJump || _currentRotateDegree === defaultJump) ? _image.addClass('w-auto') : _image.removeClass('w-auto');\n  });\n\n  // save data to server\n  let sendData = {\n    document_id: docId,\n    page: pageId + 1,\n    rotate: _currentRotateDegree,\n    delete: 0,\n  }\n  callback(sendData);\n}\n\n\nexport function addCommentToDocument(pagesNumber, recipientsList, callback) {\n  userToolList = null;\n  let defaultData = {\n    text: '',\n    recipient_arr: recipientsList.map(v => v.id).join(),\n  }\n  addCommentButton = commentElement(recipientsList, defaultData);\n\n  $(document).ready(function () {\n\n    // =======\n    // click add tool\n    // =======\n    $(`div[id^=\"${droppableContent}\"]`).click((e) => {\n\n      if (addCommentButton) {\n\n        const currentTarget = $(e.currentTarget);\n        const page_num = currentTarget.data(\"page_num\");\n        const addNewToolToContent = $(addCommentButton).clone();\n        let element_style = {\n          position: 'absolute',\n          left: e.originalEvent.layerX,\n          top: e.originalEvent.layerY,\n          zIndex: zIndexDefault,\n        }\n        addNewToolToContent.addClass(\"user-drag on-user-drag drag-success user-can-delete addCommentElement\");\n        addNewToolToContent.css(element_style);\n        addNewToolToContent.removeAttr('id');\n        addNewToolToContent.appendTo(currentTarget)\n\n        addNewToolToContent.removeClass(\n          \"on-user-drag ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable defaultResize\"\n        );\n\n        addNewToolToContent.draggable({\n          cursor: \"move\",\n          revert: \"invalid\",\n          zIndex: zIndexDefault,\n          delay: 200,\n        });\n\n        // save position\n        sendCallback(addNewToolToContent, page_num, DATA_COMMENT_TYPE, callback, recipientsList.map(v => v.id).join());\n\n        // Toggle Comment Form \n        handleCommentForm(addNewToolToContent, callback);\n\n        // remove active class tool\n        addCommentButton = null;\n\n        const checkHasElement = $(`#${documentContainer} .temporaryTool`);\n        checkHasElement.remove();\n      }\n    });\n\n    // ========\n    // add tool to mouse when tool available\n    // ========\n    const $droppableContent = $(`div[id^=\"${droppableContent}\"]`);\n    const $documentContainer = $(`#${documentContainer}`);\n    $droppableContent.on('mousemove', function (e) {\n      if (addCommentButton) {\n        const addNewToolToContent = $(addCommentButton).clone();\n        let element_style = {\n          position: 'absolute',\n          left: e.originalEvent.pageX - $documentContainer.offset().left + marginDefault,\n          top: e.originalEvent.pageY - $documentContainer.offset().top + marginDefault,\n          zIndex: zIndexDefault,\n        }\n        const checkHasElement = $(`#${documentContainer} #${$(addNewToolToContent).attr('id')}`);\n        checkHasElement.length === 0 && addNewToolToContent.appendTo($(`#${documentContainer}`));\n        $(checkHasElement).css(element_style);\n        $(checkHasElement).addClass('temporaryTool');\n\n        $droppableContent.mouseout(() => {\n          const checkHasElement = $(`#${documentContainer} .temporaryTool`);\n          checkHasElement.remove();\n        });\n      }\n    });\n\n  });\n}\n\nexport function generalDefaultButton(annotations, recipientsList, callback) {\n  annotations.map((annotation, key) => {\n    if (annotation.type === DATA_TEXT_TYPE) {\n      // left button\n      let recipient = recipientsList.filter(v => annotation.actor_id === v.id);\n      annotation.actor = recipient && recipient.length > 0 && recipient[0];\n      let tool = prepareTools.find(v => v.name === annotation.type_tools);\n      const page_num = annotation.page_num;\n      let _dropableContentId = `${droppableContent}${page_num}`;\n\n      let element_style = `position: absolute; color: ${annotation.actor.color}; background: #fff; border: 1px solid ${annotation.actor.color}; left: ${annotation.pos_x}px; top: ${annotation.pos_y}px; z-index: 1111; width: 143px; height: 31px;`;\n\n      let new_element = `\n        <span\n          data-color='${annotation.actor && annotation.actor.color}'\n          data-tool='${addDataToElement(annotation.creator_id, annotation.actor, tool)}'\n          data-annotation_id='${annotation.id}'\n          class='user-drag drag-success user-can-delete tool-sign tool_sign_${annotation.id}'\n          style='${element_style}'\n        >\n          <i class=\"${tool.icon}\" />\n          <span>${tool.label}</span>\n        </span>\n      `;\n      new_element = $($.parseHTML(new_element)[1]);\n\n      new_element.detach().appendTo(`#${_dropableContentId}`);\n\n      new_element.resizable().resizable('destroy');\n      new_element.resizable(resizeOption(() => {\n        sendCallback(new_element, page_num, callback);\n      }));\n    } else if (annotation.type === DATA_COMMENT_TYPE) {\n      // comment button\n      const page_num = annotation.page_num;\n      let _dropableContentId = `${droppableContent}${page_num}`;\n      let new_element = commentElement(recipientsList, annotation, annotation.id);\n\n      new_element = $($.parseHTML(new_element)[1]);\n      let element_style = {\n        position: 'absolute',\n        left: annotation.pos_x,\n        top: annotation.pos_y,\n        zIndex: zIndexDefault,\n      }\n\n      new_element.addClass(`user-drag drag-success user-can-delete tool-sign tool_sign_${annotation.id} addCommentElement`);\n      new_element.css(element_style);\n      new_element.detach().appendTo(`#${_dropableContentId}`)\n\n      // Toggle Comment Form \n      handleCommentForm(new_element, callback);\n\n    }\n  });\n}\n\nexport function unredoButton(id, type) {\n  type === \"undo\" ? $(\".tool_sign_\" + id).hide() : $(\".tool_sign_\" + id).show()\n}\n\nfunction addDataToElement(creator_id, item, tool) {\n  return JSON.stringify({ ...omit(item, [\"children\", \"pivot\", \"phone\", \"password\", \"created_at\", \"updated_at\"]), tool: { ...tool }, clientId: creator_id });\n}\n\nexport function initialPrepare(pages) {\n  $(document).ready(function () {\n    pages.map((page, index) => {\n      let _page_doc_id = `#${documentID}${page.docId}_${page.pageNum}`;\n      let _page_doc_nav_id_ = `#doc_nav_id_${page.docId}_${page.pageNum}`;\n      if (firstPageLoading) {\n        // =======\n        // loading image\n        // =======\n\n        // loader content page\n        $(`${_page_doc_id} .loader_img`).show();\n        $(`${_page_doc_id} .main_img`).on('load', function () {\n          $(`${_page_doc_id} .loader_img`).hide();\n        });\n        // loader nav page\n        $(`${_page_doc_nav_id_} .loader_img`).show();\n        $(`${_page_doc_nav_id_} .main_img`).on('load', function () {\n          $(`${_page_doc_nav_id_} .loader_img`).hide();\n        });\n        // end loading image\n      } else {\n        $(`${_page_doc_id} .loader_img`).hide();\n        $(`${_page_doc_nav_id_} .loader_img`).hide();\n      }\n\n      // default rotate page\n      let _documentContainer = $(`#${documentContainer}`);\n      let _documentContainerWidth = _documentContainer.width() - 10;\n      let _docIdElement = $(`#${documentID}${page.docId}_${page.pageNum}`);\n      const defaultRotate = _docIdElement.parent().data('rotate') || 0;\n      let _height = (defaultRotate === -defaultJump || defaultRotate === defaultJump) ? _documentContainerWidth : 'auto';\n      let _translate = defaultRotate === defaultJump ? 'translateY(-20%)' : defaultRotate === -defaultJump ? 'translateY(20%)' : '';\n      let _imagesElement = _docIdElement.children('img');\n      _imagesElement.css({\n        transform: `rotate(${defaultRotate}deg) ${_translate}`,\n        height: _height,\n      });\n      (defaultRotate === -defaultJump || defaultRotate === defaultJump) ? _imagesElement.addClass('w-auto') : _imagesElement.removeClass('w-auto');\n\n    });\n\n\n    firstPageLoading = false;\n  });\n}\n\nexport function prepareHandle(pagesNumber, recipientsList, callback) {\n  $(document).ready(function () {\n    // =======\n    // click add tool\n    // =======\n    $(`div[id^=\"${droppableContent}\"]`).click((e) => {\n      if (userToolList) {\n        const currentTarget = $(e.currentTarget);\n        const page_num = currentTarget.data(\"page_num\");\n        const addNewToolToContent = $(userToolList).clone();\n        let element_style = {\n          position: 'absolute',\n          color: addNewToolToContent.data(\"color\"),\n          border: `1px solid ${addNewToolToContent.data(\"color\")}`,\n          background: \"#fff\",\n          left: e.originalEvent.layerX,\n          top: e.originalEvent.layerY + marginDefault,\n          zIndex: zIndexDefault,\n        }\n        addNewToolToContent.addClass(\"user-drag on-user-drag drag-success user-can-delete\");\n        addNewToolToContent.css(element_style);\n        addNewToolToContent.removeAttr('id');\n        addNewToolToContent.appendTo(currentTarget);\n        appendElementToDoc(addNewToolToContent, page_num, DATA_TEXT_TYPE, callback);\n\n        // remove active class tool\n        let oldToolList = $(userToolList).parent();\n        if (oldToolList.length > 0 && $(oldToolList) && $(oldToolList).hasClass('active')) {\n          $(oldToolList).removeClass('active');\n          userToolList = null;\n        }\n\n        const checkHasElement = $(`#${documentContainer} .temporaryTool`);\n        checkHasElement.remove();\n      }\n    });\n\n    // ========\n    // add tool to mouse when tool available\n    // ========\n    const $droppableContent = $(`div[id^=\"${droppableContent}\"]`);\n    const $documentContainer = $(`#${documentContainer}`);\n    $droppableContent.on('mousemove', function (e) {\n      if (userToolList) {\n\n        const addNewToolToContent = $(userToolList).clone();\n        let element_style = {\n          position: 'absolute',\n          color: addNewToolToContent.data(\"color\"),\n          border: `1px solid ${addNewToolToContent.data(\"color\")}`,\n          background: '#fff',\n          left: e.originalEvent.pageX - $documentContainer.offset().left + marginDefault,\n          top: e.originalEvent.pageY - $documentContainer.offset().top + marginDefault,\n          // left: e.originalEvent.layerX + marginDefault,\n          // top: e.originalEvent.layerY + marginDefault,\n          zIndex: zIndexDefault,\n          padding: '1px 6px',\n          borderRadius: 3,\n          opacity: 0.5,\n          transition: '0.01s',\n        }\n        const checkHasElement = $(`#${documentContainer} #${$(addNewToolToContent).attr('id')}`);\n        checkHasElement.length === 0 && addNewToolToContent.appendTo($(`#${documentContainer}`));\n        $(checkHasElement).css(element_style);\n        $(checkHasElement).addClass('temporaryTool');\n\n        $droppableContent.mouseout(() => {\n          const checkHasElement = $(`#${documentContainer} .temporaryTool`);\n          checkHasElement.remove();\n        });\n\n      }\n    });\n\n    // ========\n    // dropable tool\n    // ========\n    addUserDrag(pagesNumber, recipientsList, callback)\n\n  });\n}\n\nfunction addUserDrag(pagesNumber, recipientsList, callback) {\n  pagesNumber && pagesNumber.length > 0 && pagesNumber.map(page_num => {\n\n    page_num = page_num + 1;\n\n    //Make element draggable\n    let x = null, _dropableContentId = `${droppableContent}${page_num}`;\n    $(`#${_dropableContentId}`).droppable({\n      accept: \".user-drag\",\n      activeClass: \"user-drop-area\",\n      out: function (event, ui) {\n        const _getType = ui.helper.data(\"type\");\n        if (_getType !== DATA_COMMENT_TYPE) {\n          $(ui.helper).css({ \"color\": \"#555\", background: \"#fff\", border: `1px solid #999` });\n        }\n      },\n      over: function (event, ui) {\n        let _getColor = ui.helper.data(\"color\");\n        const _getType = ui.helper.data(\"type\");\n        if (_getType !== DATA_COMMENT_TYPE) {\n          $(ui.helper).css({ \"color\": _getColor, background: \"#fff\", border: `1px solid ${_getColor}` });\n        }\n      },\n      drop: function (e, ui) {\n        const _uiDraggableId = $(ui.draggable)[0].id;\n\n        // change position\n        let x = ui.helper.clone();\n        let _getLeftElement = x.css(\"left\").replace(\"px\", \"\") || 0,\n          _getTopElement = x.css(\"top\").replace(\"px\", \"\") || 0;\n        _getLeftElement = parseInt(_getLeftElement);\n        _getTopElement = parseInt(_getTopElement);\n\n        let __top = ui.offset.top - $(this).offset().top;\n        x.css(\"left\", Math.abs((_uiDraggableId ? 200 : 0) - _getLeftElement));\n        x.css(\"top\", Math.abs(__top));\n\n        // first time\n        if (_uiDraggableId !== \"\") {\n\n          ui.helper.remove();\n\n          // add draggable, resize \n          appendElementToDoc(x, page_num, DATA_TEXT_TYPE, callback);\n\n        }\n        // second time\n        else {\n          const _getType = ui.helper.data(\"type\");\n\n          ui.helper.remove();\n          $(ui.draggable).remove();\n\n          // add draggable, resize \n          let _data_type = _getType === DATA_COMMENT_TYPE ? DATA_COMMENT_TYPE : DATA_TEXT_TYPE;\n          appendElementToDoc(x, page_num, _data_type, callback, true);\n\n          // Toggle Comment Form \n          if (_getType === DATA_COMMENT_TYPE) {\n            console.log('comment move')\n            console.log(x.data('annotation_id'))\n            x.append(commentFormElement(recipientsList, x.data('annotation_id')))\n            hiddenCommentFormFunc();\n            handleCommentForm(x, callback, true);\n          }\n        }\n      }\n    });\n  });\n}\n\nfunction appendElementToDoc(x, page_num, type, callback, isSecondTime = false) {\n  let _dropableContentId = `${droppableContent}${page_num}`;\n\n  x.removeClass(\n    \"on-user-drag ui-draggable ui-draggable-handle ui-draggable-dragging ui-resizable defaultResize\"\n  );\n\n  x.addClass(\"drag-success user-can-delete\");\n\n  x.draggable({\n    cursor: \"move\",\n    revert: \"invalid\",\n    zIndex: zIndexDefault,\n    delay: 200,\n    stop: function (event, ui) {\n      let _getColor = ui.helper.data(\"color\");\n      $(ui.helper).css({ \"color\": _getColor, background: \"#fff\", border: `1px solid ${_getColor}` });\n      $(\".remove-user-drag\").removeClass('remove-user-drag-hover');\n    },\n    drag: function (event, ui) {\n      $(ui.helper).addClass(\"on-user-drag\");\n      $(\".remove-user-drag\").addClass('remove-user-drag-hover ');\n    },\n  });\n\n  type === DATA_TEXT_TYPE && x.resizable(resizeOption(() => {\n    sendCallback(x, page_num, type, callback);\n  }));\n\n\n  x.detach().appendTo(`#${_dropableContentId}`);\n\n  if (isSecondTime && type === DATA_TEXT_TYPE) {\n    x.resizable('destroy');\n    x.resizable(resizeOption(() => {\n      sendCallback(x, page_num, type, callback);\n    }));\n  }\n\n  sendCallback(x, page_num, type, callback);\n\n}\n\nfunction sendCallback(x, page_num, type, callback, recipient_arr, text) {\n  let _dropableContentId = $(`#${droppableContent}${page_num}`);\n  let _getDataTool = x.data(\"tool\") || {},\n    _getDataAnnotationId = x.data(\"annotation_id\"),\n    _getPosition = x.position(),\n    _getWidth = x.width() + 20,\n    _getHeight = x.height() + 10,\n    _getPageWidth = _dropableContentId.first().width(),\n    _getPageHeight = _dropableContentId.first().height();\n\n  callback({\n    ..._getDataTool,\n    annotation_id: _getDataAnnotationId || null,\n    send_data: {\n      actor_id: _getDataTool.id || 0,\n      page_num: page_num,\n      doc_id: _dropableContentId.data(\"doc_id\"),\n      width: _getPageWidth && _getPageWidth.toFixed(0),\n      height: _getPageHeight && _getPageHeight.toFixed(0),\n      pos_x: _getPosition.left && _getPosition.left.toFixed(0),\n      pos_y: _getPosition.top && _getPosition.top.toFixed(0),\n      size_w: _getWidth && _getWidth.toFixed(0),\n      size_h: _getHeight && _getHeight.toFixed(0),\n      alpha: 1,\n      text: text,\n      font_family: '',\n      font_size: 12,\n      font_weight: 'N',\n      font_color: '000000',\n      type_tools: _getDataTool.tool && _getDataTool.tool.name || type,\n      type: type,\n      recipient_arr: recipient_arr,\n      // creator_id: _getDataTool.clientId,\n    }\n  }, x);\n}\n\nfunction hiddenCommentFormFunc() {\n  $(`.popover`).popover('hide');\n  $(`.addCommentElement`).css({ 'opacity': 0.5, zIndex: zIndexDefault })\n}\n\n\nfunction handleCommentForm(parentElement, callback, isSecondTime = false) {\n  let annotation_id = parentElement.data(\"annotation_id\")\n\n  parentElement.popover({\n    html: true,\n    container: parentElement.parent(),\n    content: parentElement.children('.hiddenCommentForm')//.clone(),\n  });\n\n  $(`div[id^=\"${droppableContent}\"] .addCommentElement`).on(\"click\", e => {\n    let currentTarget = $(e.currentTarget);\n    currentTarget.css({ 'opacity': 1, zIndex: 9999 });\n  });\n\n  // add multiselect\n  if (!isSecondTime) {\n    $(`.commentForm_${annotation_id} .multiselect`)\n      .multiselect({\n        allSelectedText: 'All Recipients',\n        includeSelectAllOption: true,\n      })\n  }\n\n  // submit comment\n  $(`.commentForm_${annotation_id}`).on('submit', (e) => {\n    let formValue = $(`.commentForm_${annotation_id}`).serializeArray();\n    let newValue = mergeArraySameObjectValue(formValue);\n    const page_num = parentElement.parent().data(\"page_num\");\n\n    sendCallback(parentElement, page_num, DATA_COMMENT_TYPE, callback, newValue[1].value.join(), newValue[0].value.join())\n\n    e.preventDefault();\n  });\n\n}\n\n\nexport function userSideBarHandle(callback) {\n\n  $(document).ready(function () {\n\n    let userDrag = $(\".user-item .tool\");\n    userDrag.click(e => {\n      userDrag.hasClass('active') && userDrag.removeClass('active');\n\n      // remove or add active class\n      let currentTarget = $(e.currentTarget);\n      if (!currentTarget.hasClass('active')) {\n        currentTarget.addClass(\"active\");\n      } else {\n        currentTarget.removeClass(\"active\");\n        userToolList = null;\n      }\n\n      // set copy when click\n      if (currentTarget.children() && currentTarget.children().length > 0) {\n        userToolList = currentTarget.children()[0];\n        addCommentButton = null;\n      }\n    });\n\n\n    // pagesNumber && pagesNumber.length > 0 && pagesNumber.map(page_num => {\n    // let _dropableContentId = `${droppableContent}${page_num}`;\n    //Make element draggable\n\n    $(\".user-drag\").draggable({\n      helper: \"clone\",\n      cursor: \"move\",\n      tolerance: \"fit\",\n      zIndex: zIndexDefault,\n      // containment: \"div[id^='droppable_content_']\",\n      // containment: \"div[id^='droppable_content_']\",\n      drag: function (event, ui) {\n        $(ui.helper).addClass(\"on-user-drag\");\n        userToolList = null;\n      }\n    });\n\n    $(\".remove-user-drag\").droppable({\n      drop: function (event, ui) {\n        let x = ui.helper.clone();\n        userToolList = null;\n        callback(x.data(\"annotation_id\"), ui.draggable);\n        // $(ui.draggable).remove();\n      },\n      // hoverClass: \"remove-user-drag-hover\",\n      accept: \".user-can-delete\"\n    });\n    // });\n  });\n};\n\nexport const prepareTools = [\n  { name: \"stamp\", label: \"Stamp\", icon: \"fas fa-stamp\" },\n  { name: \"signature\", label: \"Signature\", icon: \"fa fa-pencil\" },\n  { name: \"full_name\", label: \"Full Name\", icon: \"fa fa-user\" },\n  { name: \"company\", label: \"Company\", icon: \"fa fa-building\" },\n  { name: \"title\", label: \"Title\", icon: \"fa fa-briefcase\" },\n  { name: \"text\", label: \"Text\", icon: \"fa fa-file-text\" },\n  { name: \"date_signed\", label: \"Date Signed\", icon: \"fa fa-calendar\" },\n  { name: \"attachments\", label: \"Attachments\", icon: \"fa fa-paperclip\" }\n];\n\nvar restore_state = []\nvar redo_list = []\nvar undo_list = []\n\nexport const history = {\n  restore_state,\n  redo_list,\n  undo_list,\n  saveState: function (restore_state, list, keep_redo) {\n    keep_redo = keep_redo || false;\n    if (!keep_redo) {\n      this.redo_list = [];\n    }\n\n    (list || this.undo_list).push(restore_state);\n  },\n  undo: function (data) {\n    this.undo_list = data;\n    this.restoreState(this.undo_list, this.redo_list);\n  },\n  redo: function (data = null) {\n    // if(data) {\n    //   this.undo_list = data;\n    //   this.restore_state = data.pop();\n    //   this.redo_list = []\n    // }\n    this.restoreState(this.redo_list, this.undo_list);\n  },\n  restoreState: function (pop, push) {\n    if (pop.length) {\n      this.restore_state = pop.pop();\n      this.saveState(this.restore_state, push, true);\n    }\n  }\n}\n\n// $('body').on('click', function (e) {\n//   //did not click a popover toggle or popover\n//   if ($(e.target).data('toggle') !== 'popover'\n//     && $(e.target).parents('.popover.in').length === 0) {\n//     // $('.addCommentElement').popover('hide');\n//   }\n// });\n\nfunction mergeArraySameObjectValue(array) {\n  let output = [];\n  array.forEach(function (item) {\n    let existing = output.filter(function (v, i) {\n      return v.name == item.name;\n    });\n    if (existing.length) {\n      let existingIndex = output.indexOf(existing[0]);\n      output[existingIndex].value = output[existingIndex].value.concat(item.value);\n    } else {\n      if (typeof item.value == 'string')\n        item.value = [item.value];\n      output.push(item);\n    }\n  });\n  return output;\n}"]}]}